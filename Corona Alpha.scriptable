{
  "always_run_in_app" : false,
  "icon" : {
    "color" : "deep-gray",
    "glyph" : "vial"
  },
  "name" : "Corona Alpha",
  "script" : "\/\/ Corona Alpha v1.0 - by unvsDev\n\/\/ Full-fledged Covid-19 Information for Korea\n\/\/ Learn more: https:\/\/github.com\/unvsDev\/corona-alpha\n\nconst dataURL = \"https:\/\/apiv2.corona-live.com\/stats.json\"\nconst data = await new Request(dataURL).loadJSON()\nconst sourceURL = \"https:\/\/corona-live.com\"\n\nconst today = new Date()\n\nconst orgData = {\n  region : 0,\n  alert : 0,\n  limit : 100,\n  hour : 1\n}\n\nconst regionsArr = ['ì„œìš¸', 'ë¶€ì‚°', 'ì¸ì²œ', 'ëŒ€êµ¬', 'ê´‘ì£¼', 'ëŒ€ì „', 'ìš¸ì‚°', 'ì„¸ì¢…', 'ê²½ê¸°', 'ê°•ì›', 'ì¶©ë¶', 'ì¶©ë‚¨', 'ê²½ë¶', 'ê²½ë‚¨', 'ì „ë¶', 'ì „ë‚¨', 'ì œì£¼']\n\nconst alertArr = ['ë„ê¸°', 'í™•ì§„ì ì¦ê°€ ì•Œë¦¼', 'ë§¤ ì‹œê°„ë§ˆë‹¤ ì•Œë¦¼']\n\nvar resetmode = 0\n\nlet fm = FileManager.iCloud()\nconst prefPath = fm.joinPath(fm.documentsDirectory(), \"coronaAlpha.txt\")\nconst prevPath = fm.joinPath(fm.documentsDirectory(), \"coronaData.txt\")\n\nif(!fm.fileExists(prefPath)){\n  let alert = new Alert()\n  alert.title = \"í™˜ì˜í•©ë‹ˆë‹¤!\"\n  alert.message = \"ëŒ€í•œë¯¼êµ­ ì½”ë¡œë‚˜19 í™•ì§„ì í˜„í™©ì„\\nìœ„ì ¯ì„ í†µí•´ ì§ê´€ì ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ”\\nì½”ë¡œë‚˜ ì•ŒíŒŒì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤ ğŸ’œ\\nDeveloped by unvsDev\"\n  alert.addAction(\"í™•ì¸\")\n  await alert.present()\n  fm.writeString(prefPath, JSON.stringify(orgData))\n}\n\nif(config.runsInApp) {\n  var usrData = JSON.parse(fm.readString(prefPath))\n  let menu = new UITable()\n  menu.showSeparators = true\n  \n  const option1 = new UITableRow()\n  option1.dismissOnSelect = false\n  option1.addText(\"ğŸ‡°ğŸ‡· ë¼ì´ë¸Œ ì§€ì—­ ì„¤ì •\")\n  menu.addRow(option1)\n  \n  option1.onSelect = async (number) => {\n    let regionMenu = new UITable()\n    regionMenu.showSeparators = true\n    for(reg in regionsArr){\n      const regOption = new UITableRow()\n      regOption.dismissOnSelect = true\n      regOption.addText(regionsArr[reg])\n      regionMenu.addRow(regOption)\n      \n      regOption.onSelect = async (number) => {\n        usrData[\"region\"] = number\n        let regAlert = new Alert()\n        regAlert.title = \"ë¼ì´ë¸Œ ì§€ì—­ ì„¤ì •\"\n        regAlert.message = \"ì§€ì—­ì´ \" + regionsArr[number] + \"(ìœ¼)ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\"\n        regAlert.addAction(\"í™•ì¸\")\n        await regAlert.present()\n      }\n    }\n    await regionMenu.present(false)\n  }\n  \n  const option2 = new UITableRow()\n  option2.dismissOnSelect = false\n  option2.addText(\"ğŸ¤– ì‹¤ì‹œê°„ ì•Œë¦¼ ì„¤ì •\")\n  menu.addRow(option2)\n  \n  option2.onSelect = async () => {\n    let alAlert = new Alert()\n    alAlert.title = \"ì‹¤ì‹œê°„ ì•Œë¦¼\"\n    alAlert.message = \"ì•Œë¦¼ ì—¬ë¶€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.\\ní˜„ì¬ ì„¤ì •ê°’ì€ \\\"\" + alertArr[usrData.alert] + \"\\\" ì…ë‹ˆë‹¤!\"\n    for(opt in alertArr){\n      alAlert.addAction(alertArr[opt])\n    }\n    var choice = await alAlert.present()\n    usrData.alert = choice\n  }\n  \n  const option3 = new UITableRow()\n  option3.dismissOnSelect = false\n  option3.addText(\"ğŸ“ˆ í™•ì§„ì ì¦ê°€í­ ì„¤ì • (ì•Œë¦¼)\")\n  menu.addRow(option3)\n  \n  option3.onSelect = async () => {\n    if(usrData.alert == 1){\n      let limAlert = new Alert()\n      limAlert.title = \"ì¦ê°€í­ ì„¤ì •\"\n      limAlert.message = \"ì•Œë¦¼ì„ ìˆ˜ì‹ í•  ìµœì†Œ ì¦ê°€í­ì„ ì„¤ì •í•˜ì„¸ìš”.\\níš¨ìœ¨ì ì¸ ìˆ˜ì‹ ì€ 100~200ëª…ì„ ì¶”ì²œí•©ë‹ˆë‹¤.\\ní˜„ì¬ ì„¤ì •ê°’ì€ \\\"\" + usrData.limit.toString() + \"ëª…\\\" ì…ë‹ˆë‹¤!\"\n      \n      limAlert.addTextField(\"ì¦ê°€í­ ì…ë ¥\", usrData[\"limit\"].toString())\n      limAlert.addAction(\"í™•ì¸\")\n      limAlert.addCancelAction(\"ì·¨ì†Œ\")\n      if(await limAlert.present() != -1){\n        usrData.limit = parseInt(limAlert.textFieldValue())\n      }\n    } else {\n      let limAlert = new Alert()\n      limAlert.title = \"ìŒ.. ğŸ¤”\"\n      limAlert.message = \"ì¦ê°€í­ ì•Œë¦¼ë§Œ ì„¤ì • ê°€ëŠ¥í•œ ì˜µì…˜ì…ë‹ˆë‹¤.\"\n      limAlert.addAction(\"í™•ì¸\")\n      await limAlert.present()\n    }\n  }\n  \n  const option4 = new UITableRow()\n  option4.dismissOnSelect = false\n  option4.addText(\"â° ê³ ì • ì‹œê°„ ê°„ê²© ì„¤ì • (ì•Œë¦¼)\")\n  menu.addRow(option4)\n  \n  option4.onSelect = async () => {\n    if(usrData.alert == 2){\n      let hrAlert = new Alert()\n      hrAlert.title = \"ì‹œê°„ ê°„ê²© ì„¤ì •\"\n      hrAlert.message = \"ì•Œë¦¼ì„ ìˆ˜ì‹ í•  ì‹œê°„ ê°„ê²©(ì‹œê°„)ì„ ì„¤ì •í•˜ì„¸ìš”.\\níš¨ìœ¨ì ì¸ ìˆ˜ì‹ ì€ 1ì‹œê°„ì„ ì¶”ì²œí•©ë‹ˆë‹¤.\\ní˜„ì¬ ì„¤ì •ê°’ì€ \\\"\" + usrData.hour.toString() + \"ì‹œê°„\\\" ì…ë‹ˆë‹¤!\"\n      \n      hrAlert.addTextField(\"ì‹œê°„ ê°„ê²© ì…ë ¥\", usrData[\"hour\"].toString())\n      \n      hrAlert.addAction(\"í™•ì¸\")\n      hrAlert.addCancelAction(\"ì·¨ì†Œ\")\n      if(await hrAlert.present() != -1){\n        usrData.hour = parseInt(hrAlert.textFieldValue())\n      }\n    } else {\n      let hrAlert = new Alert()\n      hrAlert.title = \"ìŒ.. ğŸ¤”\"\n      hrAlert.message = \"ë§¤ì‹œê°„ ì•Œë¦¼ë§Œ ì„¤ì • ê°€ëŠ¥í•œ ì˜µì…˜ì…ë‹ˆë‹¤.\"\n      hrAlert.addAction(\"í™•ì¸\")\n      await hrAlert.present()\n    }\n  }\n  \n  const option5 = new UITableRow()\n  option5.dismissOnSelect = true\n  option5.addText(\"ğŸ”¥ ë°ì´í„° ì´ˆê¸°í™”\")\n  menu.addRow(option5)\n  \n  option5.onSelect = async () => {\n    resetmode = 1\n    let resetAlert = new Alert()\n    resetAlert.title = \"ì •ë§ìš”..? ğŸ˜­\"\n    resetAlert.message = \"íƒ€ë…¸ìŠ¤ê°€ ë°ì´í„°ë¥¼ ëŒ€ì‹  ì‚­ì œí•´ì£¼ê¸° ë•Œë¬¸ì—, ì ˆëŒ€ ë˜ëŒë¦´ ìˆ˜ ì—†ì–´ìš”! ì •ë§ ì´ˆê¸°í™”í•˜ì‹œê² ì–´ìš”?\"\n    resetAlert.addDestructiveAction(\"ì´ˆê¸°í™”\")\n    resetAlert.addCancelAction(\"ì·¨ì†Œ\")\n    \n    if(await resetAlert.present() != -1){\n      fm.remove(prefPath)\n      if(fm.fileExists(prevPath)){\n        fm.remove(prevPath)\n      }\n    }\n  }\n  \n  const option6 = new UITableRow()\n  option6.dismissOnSelect = false\n  option6.addText(\"ğŸ„ Github\")\n  menu.addRow(option6)\n  \n  option6.onSelect = () => {\n    Safari.openInApp(\"https:\/\/github.com\/unvsDev\/corona-alpha\", false)\n  }\n  \n  await menu.present(false)\n  \n  fm.writeString(prefPath, JSON.stringify(usrData))\n}\n\nif(resetmode){ return 0 }\n\nvar aftData = JSON.parse(fm.readString(prefPath))\n\n\/\/ Getting Data\nlet overview = data[\"overview\"]\nlet regionData = data[\"current\"][aftData.region.toString()][\"cases\"]\n\nvar currentCnt = overview[\"current\"][0]\nvar currentGap = overview[\"current\"][1]\nvar totalCnt = overview[\"confirmed\"][0]\nvar totalGap = overview[\"confirmed\"][1]\nvar regionCnt = regionData[0]\nvar regionGap = regionData[1]\n\nconst incColor = new Color(\"#ff3800\")\nconst decColor = new Color(\"#32d9cb\")\n\nfunction getGapStr(number) {\n  var result = new String(\"ì½”ë¡œë‚˜19ì— ë§ì„œ ì—´ì‹¬íˆ ì‹¸ì›Œì£¼ì‹œëŠ” ì˜ë£Œì§„ë¶„ë“¤ê»˜ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤ ğŸ‘\") \/\/ Easter Egg!\n  if(number == 0) {\n    return result = \"0\"\n  } else if(number > 0) {\n    return result = \"+\" + addComma(number)\n  } else {\n    return result = addComma(number)\n  }\n}\n\nfunction getGapColor(number) {\n  if(number <= 0) {\n    return decColor\n  } else {\n    return incColor\n  }\n}\n\nasync function writeCovidReport() {\n  await fm.writeString(prevPath, JSON.stringify({\"date\":today.getDate(), \"hour\":today.getHours(), \"confirmed\":currentCnt}))\n  console.log(\"[*] ë¡œê·¸ ì €ì¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\")\n}\n\nasync function sendNotification(title, message){\n  let noti = new Notification()\n  noti.title = title\n  noti.body = message\n  await noti.schedule()\n}\n\nif(aftData.alert == 1){ \/\/ í™•ì§„ì ì¦ê°€í­ ì•Œë¦¼\n  if(!fm.fileExists(prevPath)){\n    await writeCovidReport()\n    await sendNotification(\"í™•ì§„ì ì¦ê°€í­ ì•Œë¦¼\", \"ì´ì „ ë°ì´í„°ê°€ ì—†ì–´ ìµœì´ˆ 1íšŒëŠ” ì•Œë¦¼ì´ ì˜¤ì§€ ì•ŠìŠµë‹ˆë‹¤.\")\n  } else {\n    var prevData = JSON.parse(fm.readString(prevPath))\n    var diff = currentCnt - prevData.confirmed\n    if(diff >= aftData.limit) { \n      await sendNotification(\"ì½”ë¡œë‚˜19 í™•ì§„ì +\" + diff + \"ëª…\", \"í˜„ì¬ê¹Œì§€ ì´ í™•ì§„ìëŠ” \" + currentCnt + \"ëª…ì…ë‹ˆë‹¤.\\nì†ì”»ê¸° ìƒí™œí™”, ì–´ë””ì„œë“  ë§ˆìŠ¤í¬ ì°©ìš©ì„ í†µí•´ ì½”ë¡œë‚˜ë¥¼ ì´ê²¨ë‚´ìš”! ğŸ˜\")\n      await writeCovidReport()\n    }\n  }\n}\n\nif(aftData.alert == 2){ \/\/ ë§¤ì‹œê°„ í™•ì§„ì ì•Œë¦¼\n  if(!fm.fileExists(prevPath)){\n    await writeCovidReport()\n    await sendNotification(\"ë§¤ì‹œê°„ í™•ì§„ì ì•Œë¦¼\", \"ì´ì „ ë°ì´í„°ê°€ ì—†ì–´ ìµœì´ˆ 1íšŒëŠ” ì•Œë¦¼ì´ ì˜¤ì§€ ì•ŠìŠµë‹ˆë‹¤.\")\n  } else {\n    var prevData = JSON.parse(fm.readString(prevPath))\n    var lastDate = prevData.date\n    var lastHour = prevData.hour\n    if(today.getDate() != lastDate){\n      await sendNotification(\"ì½”ë¡œë‚˜19 ì–´ì œ í™•ì§„ì ìµœì†Œ \" + prevData.confirmed + \"ëª…\", \"ì†ì”»ê¸° ìƒí™œí™”, ì–´ë””ì„œë“  ë§ˆìŠ¤í¬ ì°©ìš©ì„ í†µí•´ ì½”ë¡œë‚˜ë¥¼ ì´ê²¨ë‚´ìš”! ğŸ˜\")\n      await writeCovidReport()\n    }else if(today.getHours() != lastHour){\n      var diff = currentCnt - prevData.confirmed\n      await sendNotification(\"ì½”ë¡œë‚˜19 \" + today.getHours() + \"ì‹œ ê¸°ì¤€ +\" + diff + \"ëª…\", \"í˜„ì¬ê¹Œì§€ ì´ í™•ì§„ìëŠ” \" + currentCnt + \"ëª…ì…ë‹ˆë‹¤.\\nì†ì”»ê¸° ìƒí™œí™”, ì–´ë””ì„œë“  ë§ˆìŠ¤í¬ ì°©ìš©ì„ í†µí•´ ì½”ë¡œë‚˜ë¥¼ ì´ê²¨ë‚´ìš”! ğŸ˜\")\n      await writeCovidReport()\n    }\n  }\n}\n\n\/\/ Widget Layout\nlet cwidget = new ListWidget()\n\nlet title = cwidget.addText(\"CORONA ALPHA\")\ntitle.textColor = new Color(\"#fff\")\ntitle.font = Font.blackMonospacedSystemFont(8)\n\ncwidget.addSpacer(5)\n\nlet cStack1 = cwidget.addStack()\ncStack1.layoutHorizontally()\ncStack1.centerAlignContent()\n\nlet inStack1 = cStack1.addStack()\ninStack1.layoutVertically()\ninStack1.centerAlignContent()\n\nlet liveTitle = inStack1.addText(\"ë¼ì´ë¸Œ\")\nliveTitle.textColor = new Color(\"#fff\")\nliveTitle.font = Font.blackMonospacedSystemFont(10)\n\nlet liveCompare = inStack1.addText(getGapStr(currentGap))\nliveCompare.textColor = getGapColor(currentGap)\nliveCompare.font = Font.boldMonospacedSystemFont(8)\n\ncStack1.addSpacer()\n\nlet liveLabel = cStack1.addText(addComma(currentCnt))\nliveLabel.textColor = new Color(\"#fff\")\nliveLabel.font = Font.boldMonospacedSystemFont(27)\n\nlet cStack2 = cwidget.addStack()\ncStack2.layoutHorizontally()\ncStack2.centerAlignContent()\n\nlet inStack2 = cStack2.addStack()\ninStack2.layoutVertically()\ninStack2.centerAlignContent()\n\nlet localTitle = inStack2.addText(regionsArr[aftData.region])\nlocalTitle.textColor = new Color(\"#fff\")\nlocalTitle.font = Font.blackMonospacedSystemFont(10)\n\nlet localCompare = inStack2.addText(getGapStr(regionGap))\nlocalCompare.textColor = getGapColor(regionGap)\nlocalCompare.font = Font.boldMonospacedSystemFont(8)\n\ncStack2.addSpacer()\n\nlet localLabel = cStack2.addText(addComma(regionCnt))\nlocalLabel.textColor = new Color(\"#fff\")\nlocalLabel.font = Font.boldMonospacedSystemFont(27)\n\nlet cStack3 = cwidget.addStack()\ncStack3.layoutHorizontally()\ncStack3.centerAlignContent()\n\nlet inStack3 = cStack3.addStack()\ninStack3.layoutVertically()\ninStack3.centerAlignContent()\n\nlet totalTitle = inStack3.addText(\"ì´í•©\")\ntotalTitle.textColor = new Color(\"#fff\")\ntotalTitle.font = Font.blackMonospacedSystemFont(10)\n\nlet totalCompare = inStack3.addText(getGapStr(totalGap))\ntotalCompare.textColor = getGapColor(totalGap)\ntotalCompare.font = Font.boldMonospacedSystemFont(8)\n\ncStack3.addSpacer()\n\nlet totalLabel = cStack3.addText(addComma(totalCnt))\ntotalLabel.textColor = new Color(\"#fff\")\ntotalLabel.font = Font.boldMonospacedSystemFont(27)\n\ncwidget.addSpacer(5)\n\nfunction formatTime(date) {\n    let df = new DateFormatter()\n    df.useNoDateStyle()\n    df.useShortTimeStyle()\n    return df.string(date)\n}\n\nlet updateLabel = cwidget.addText(\"ì—…ë°ì´íŠ¸: \" + formatTime(today))\nupdateLabel.textColor = new Color(\"#fff\")\nupdateLabel.font = Font.systemFont(8)\nupdateLabel.textOpacity = 0.7\n\nfunction addComma(number) {\n  return number.toString().replace(\/\\B(?=(\\d{3})+(?!\\d))\/g, ',')\n}\n\ncwidget.refreshAfterDate = new Date(Date.now() + 1000 * 90) \/\/ Refresh every 90 Second\n\ncwidget.url = sourceURL\ncwidget.setPadding(12, 12, 12, 12)\ncwidget.backgroundColor = new Color(\"#333\")\ncwidget.presentSmall()\nScript.complete()",
  "share_sheet_inputs" : [

  ]
}